# FileShare 文档中心

欢迎使用 FileShare 文件共享系统！本文档中心包含系统的完整文档。

## 📚 文档目录

### 1. [系统操作指南](./operation-guide.md) ⭐ 推荐
**完整的系统操作手册，包含所有功能的使用说明**

- 系统概述
- 快速开始
- 用户操作指南（文件管理、空间管理、文件共享等）
- 管理员操作指南（用户管理、权限管理、系统配置等）
- 系统模块说明
- 常见问题解答

**适合人群**：所有用户、管理员

---

### 2. [系统架构与模块说明](./system-architecture.md)
**系统技术架构和模块间关系的详细说明**

- 系统架构图
- 核心模块说明（11个核心模块）
- 数据库设计
- 模块间调用关系
- API 接口设计
- 安全机制
- 性能优化
- 扩展性设计

**适合人群**：开发人员、系统管理员、技术负责人

---

### 2.1 [模块关系详细说明](./module-relationships.md) ⭐ 推荐
**系统各模块之间的详细关系和调用流程**

- 模块依赖关系图
- 11个核心模块详细说明
- 模块间数据流（上传/下载/权限检查）
- 模块通信接口
- 数据库关联关系
- 扩展点说明
- 最佳实践

**适合人群**：开发人员、系统架构师

---

### 3. [用户操作手册](./user-manual.md)
**面向最终用户的详细操作手册**

- 快速开始
- 文件管理操作
- 空间管理操作
- 文件共享操作
- 权限管理操作
- 常见问题

**适合人群**：最终用户

---

### 4. [部署指南](./deployment.md)
**系统部署和运维的完整指南**

- 环境要求
- Linux 部署步骤
- Windows Server 部署步骤
- 防火墙配置
- 数据备份
- 系统维护
- 故障排查
- 性能优化
- 安全建议

**适合人群**：系统管理员、运维人员

---

### 5. [加密配置指南](./encryption-config.md)
**文件加密配置的详细说明**

- 加密模式说明（明文/SM4/AES-256/外部SDK）
- 配置步骤
- 加密模式切换
- 外部SDK开发指南
- 安全建议
- 故障排查

**适合人群**：系统管理员、安全管理员

---

## 🗺️ 系统模块关系图

```
                    ┌──────────────┐
                    │  用户认证模块  │
                    │  (auth)      │
                    └──────┬───────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                   │
        ▼                  ▼                   ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  文件管理模块  │  │  空间管理模块  │  │  用户管理模块  │
│  (files)     │  │  (spaces)    │  │  (users)     │
└──────┬───────┘  └──────┬───────┘  └──────┬───────┘
       │                  │                  │
       ├──────────────────┼──────────────────┤
       │                  │                  │
       ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  权限控制模块  │  │  加密模块    │  │  日志模块    │
│ (permissions)│  │ (encryption) │  │  (logger)    │
└──────┬───────┘  └──────────────┘  └──────────────┘
       │
       ├──→ 文件分享模块 (shares)
       ├──→ 评论模块 (comments)
       └──→ 搜索模块 (search)
```

## 📋 模块依赖关系

### 核心依赖链

1. **认证模块** → 所有业务模块的基础
2. **权限模块** → 被文件、空间、分享、评论模块依赖
3. **加密模块** → 被文件管理模块依赖
4. **日志模块** → 被所有业务模块调用

### 数据流向

```
用户操作
  ↓
认证验证 (auth)
  ↓
权限检查 (permissions)
  ↓
业务处理 (files/spaces/shares/comments)
  ↓
数据存储 (database)
  ↓
日志记录 (logger)
```

## 🔄 典型业务流程

### 文件上传流程
```
用户点击上传
  → 前端选择文件
  → 发送到后端 /api/files/upload
  → authenticate 中间件验证身份
  → 权限检查（checkPermission）
  → Multer 接收文件
  → 加密处理（encryptFile）
  → 保存到存储目录
  → 记录到数据库（files 表）
  → 记录操作日志（logOperation）
  → 返回成功响应
```

### 文件下载流程
```
用户点击下载
  → 前端请求 /api/files/download/:fileId
  → authenticate 中间件验证身份
  → 权限检查（checkPermission）
  → 读取文件（fs.readFile）
  → 解密处理（decryptFile）
  → 设置响应头
  → 返回文件流
  → 记录操作日志
```

### 权限设置流程
```
管理员设置权限
  → 前端发送 /api/permissions
  → authenticate 验证管理员身份
  → 检查资源是否存在
  → 删除旧权限
  → 添加新权限（permissions 表）
  → 记录操作日志
  → 返回成功
```

## 📊 数据库关系

### 核心表关系

```
users (用户)
  ├── files.created_by (创建的文件)
  ├── files.updated_by (更新的文件)
  ├── spaces.owner_id (拥有的空间)
  └── permissions.user_id (拥有的权限)

spaces (空间)
  ├── files.space_id (空间中的文件)
  └── folders.space_id (空间中的文件夹)

files (文件)
  ├── file_versions.file_id (文件版本)
  ├── comments.file_id (文件评论)
  └── permissions.resource_id (文件权限)

permissions (权限)
  ├── user_id (用户权限)
  └── group_id (用户组权限)
```

## 🛠️ 开发指南

### 添加新功能模块

1. **创建路由文件**：`server/routes/new-module.js`
2. **实现业务逻辑**：处理请求和响应
3. **添加权限检查**：使用 `authenticate` 和 `checkPermission`
4. **记录操作日志**：使用 `logOperation`
5. **创建前端页面**：`client/src/pages/NewModule.tsx`
6. **添加路由**：在 `client/src/App.tsx` 中注册

### 代码规范

- **路由命名**：RESTful 风格
- **函数命名**：驼峰命名
- **数据库命名**：下划线命名
- **错误处理**：统一的错误响应格式
- **日志记录**：所有重要操作都要记录

## 📖 快速查找

### 按角色查找文档

- **最终用户** → [用户操作手册](./user-manual.md)
- **系统管理员** → [部署指南](./deployment.md) + [操作指南](./operation-guide.md)
- **开发人员** → [系统架构文档](./system-architecture.md)
- **安全管理员** → [加密配置指南](./encryption-config.md)

### 按任务查找文档

- **首次部署** → [部署指南](./deployment.md)
- **日常使用** → [操作指南](./operation-guide.md)
- **问题排查** → [操作指南 - 常见问题](./operation-guide.md#常见问题)
- **系统维护** → [部署指南 - 系统维护](./deployment.md#六系统维护)
- **配置加密** → [加密配置指南](./encryption-config.md)

## 🔗 相关资源

- **项目 README**：`../README.md`
- **快速开始**：`../QUICKSTART.md`
- **变更日志**：`../CHANGELOG-ENCRYPTION.md`

## 📝 文档更新

文档会随着系统更新而持续维护。如有问题或建议，请联系开发团队。

---

**文档版本**：v1.0  
**最后更新**：2024年

